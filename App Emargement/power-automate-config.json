{
  "powerAutomate": {
    "description": "Configuration pour l'intégration avec Power Automate",
    "version": "1.0",
    "endpoints": {
      "emargement": {
        "url": "http://votre-serveur:3000/api/emargement",
        "method": "POST",
        "headers": {
          "x-api-key": "votre_cle_api_secrete",
          "Content-Type": "application/json"
        },
        "description": "Génère une feuille d'émargement PDF"
      },
      "test": {
        "url": "http://votre-serveur:3000/api/test",
        "method": "POST",
        "headers": {
          "x-api-key": "votre_cle_api_secrete"
        },
        "description": "Génère un PDF de test"
      },
      "health": {
        "url": "http://votre-serveur:3000/api/health",
        "method": "GET",
        "description": "Vérifie l'état de l'API"
      }
    },
    "flowExamples": {
      "triggerOnFormSubmit": {
        "name": "Générer Émargement - Soumission Formulaire",
        "trigger": "When a new response is submitted (Microsoft Forms)",
        "actions": [
          {
            "name": "HTTP Request",
            "type": "http",
            "config": {
              "method": "POST",
              "uri": "http://votre-serveur:3000/api/emargement",
              "headers": {
                "x-api-key": "votre_cle_api_secrete",
                "Content-Type": "application/json"
              },
              "body": {
                "participant": {
                  "nom": "@{triggerBody()?['nom']}",
                  "prenom": "@{triggerBody()?['prenom']}",
                  "signature_matin": "@{triggerBody()?['signature_matin']}",
                  "signature_soir": "@{triggerBody()?['signature_soir']}",
                  "code_session": "@{triggerBody()?['code_session']}",
                  "date_du_cours": "@{formatDateTime(triggerBody()?['date_du_cours'], 'dd/MM/yyyy')}",
                  "nom_formation": "@{triggerBody()?['nom_formation']}",
                  "nom_du_cours": "@{triggerBody()?['nom_du_cours']}"
                },
                "intervenants": "@{triggerBody()?['intervenants']}"
              }
            }
          },
          {
            "name": "Create file",
            "type": "onedrive",
            "config": {
              "folderPath": "/Emargements",
              "fileName": "emargement_@{formatDateTime(utcNow(), 'yyyyMMdd_HHmmss')}.pdf",
              "fileContent": "@{body('HTTP_Request')}"
            }
          },
          {
            "name": "Send email",
            "type": "office365",
            "config": {
              "to": "@{triggerBody()?['email']}",
              "subject": "Feuille d'émargement générée",
              "body": "Votre feuille d'émargement a été générée avec succès.",
              "attachments": [
                {
                  "name": "emargement.pdf",
                  "content": "@{body('HTTP_Request')}",
                  "contentType": "application/pdf"
                }
              ]
            }
          }
        ]
      },
      "triggerOnSharePoint": {
        "name": "Générer Émargement - SharePoint",
        "trigger": "When an item is created (SharePoint)",
        "actions": [
          {
            "name": "Get item",
            "type": "sharepoint",
            "config": {
              "siteId": "@{triggerBody()?['siteId']}",
              "listId": "@{triggerBody()?['listId']}",
              "id": "@{triggerBody()?['id']}"
            }
          },
          {
            "name": "HTTP Request",
            "type": "http",
            "config": {
              "method": "POST",
              "uri": "http://votre-serveur:3000/api/emargement",
              "headers": {
                "x-api-key": "votre_cle_api_secrete",
                "Content-Type": "application/json"
              },
              "body": {
                "participant": {
                  "nom": "@{body('Get_item')?['nom']}",
                  "prenom": "@{body('Get_item')?['prenom']}",
                  "signature_matin": "@{body('Get_item')?['signature_matin']}",
                  "signature_soir": "@{body('Get_item')?['signature_soir']}",
                  "code_session": "@{body('Get_item')?['code_session']}",
                  "date_du_cours": "@{formatDateTime(body('Get_item')?['date_du_cours'], 'dd/MM/yyyy')}",
                  "nom_formation": "@{body('Get_item')?['nom_formation']}",
                  "nom_du_cours": "@{body('Get_item')?['nom_du_cours']}"
                },
                "intervenants": "@{body('Get_item')?['intervenants']}"
              }
            }
          },
          {
            "name": "Create file",
            "type": "sharepoint",
            "config": {
              "siteId": "@{triggerBody()?['siteId']}",
              "folderPath": "/Documents/Emargements",
              "fileName": "emargement_@{formatDateTime(utcNow(), 'yyyyMMdd_HHmmss')}.pdf",
              "fileContent": "@{body('HTTP_Request')}"
            }
          }
        ]
      }
    },
    "variables": {
      "apiUrl": "http://votre-serveur:3000",
      "apiKey": "votre_cle_api_secrete",
      "outputFolder": "/Emargements"
    },
    "errorHandling": {
      "retryPolicy": {
        "type": "exponentialBackoff",
        "count": 3,
        "interval": "PT1M"
      },
      "errorActions": [
        {
          "condition": "@{equals(statusCode('HTTP_Request'), 401)}",
          "action": "Send email notification - Invalid API key"
        },
        {
          "condition": "@{equals(statusCode('HTTP_Request'), 400)}",
          "action": "Send email notification - Invalid data"
        },
        {
          "condition": "@{equals(statusCode('HTTP_Request'), 500)}",
          "action": "Send email notification - Server error"
        }
      ]
    }
  }
} 